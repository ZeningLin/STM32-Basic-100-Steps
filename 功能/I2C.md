# I2C通信协议
## 综述
- 两线通信，半双工
- 所有设备都可以作为主机/从机，但一个时刻只能有一个主机


## 通信格式
- 传送数据时，仅当`SCL`低电平时`SDA`才能变化
- 当`SCL`处于高电平时，若`SDA`拉低则表示起始位，`SDA`拉高则表示终止位

### 主机向从机写入数据
主机发送起始位后，发送一个字节的接收端地址位，地址位高7位表示地址，第0位表示读(1)或者写(0)，此处为0，从机接收后发送一位低电平应答位；之后主机发送数据位，主机发送一个字节的数据紧跟从机回复的一个字节的应答位，以此类推；发送结束后发送端发送停止位，通信结束。

### 主机读取从机数据
主机发送起始位后紧跟从机地址位，从机回复低电平应答位；之后从机发送一个字节数据，主机回复低电平应答位；重复数据发送过程；主机接收最后一个字节后回复高电平非应答位，从机停止数据发送；主机发送停止位释放总线。

## 在STM32F1上的实际应用
### 引脚
- STM32F103C8有两组I2C接口，分别占用42/43(PB6/PB7)和21/22(PB10/PB11)引脚

### 线路配置
- 两引脚配置复用开漏模式
- 接上拉电阻(理论2k，实际1~10k)
- 在STM32F1系列中，I2C接入APB1总线，初始化时记得打开总线时钟
- 总线上的器件拥有唯一地址，最多127个器件(新版规范增加10位地址模式，最多达1023个器件)

